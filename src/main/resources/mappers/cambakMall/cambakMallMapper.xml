<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.cambak21.mappers.cambakMallMapper">
  	<!-- 김대기 맵퍼 -->
  	<!-- 주소록 리스트 가져오는 셀렉트 문 -->
  	<select id="destinationSelect" resultType="com.cambak21.domain.DestinationVO">
  		select * from goot6.Destinations where member_id = #{member_id}
  	</select>
  	<!-- 한개 주소록 -->
  	<select id="selectDestOne" resultType="com.cambak21.domain.DestinationVO">
  		select * from goot6.Destinations where destination_no = #{destination_no}
  	</select>
  	<!-- 기본 주소록 -->
  	<select id="defaultDest" resultType="com.cambak21.domain.DestinationVO">
  		select * from goot6.Destinations where member_id = #{member_id} and destination_no = default_address;
  	</select>
  	
  	
  	<!-- 장원영 맵퍼 -->
  	<select id="bucketInfoSelect" resultType="com.cambak21.domain.ProdInfoVO">
  		select bp.buyProduct_no, p.product_name, p.product_img1, bp.buyProduct_qty, p.product_sellPrice, bp.buyProduct_deliveriPay, bp.buyProduct_totPrice, m.member_id
		from BuyProducts bp inner join Members m inner join Products p
		on bp.member_id = m.member_id and bp.product_id = p.product_id
		where bp.member_id = #{member_id} and bp.buyProduct_isFinished = 'N'
  	</select>
  	
  	<select id="viewPoint" resultType="com.cambak21.domain.PointVO">
  		select member_totPoint from Members where member_id = #{member_id};
  	</select>
  	
  	<select id="usePoint" resultType="com.cambak21.domain.PointVO">
 		insert into Points (buyProduct_no, member_id, grade_name, buyProduct_totPrice, point_reason, point_usedPoint, point_futurePoint, payment_date)
		values (#{buyProduct_no}, #{member_id}, #{grade_name}, #{buyProduct_totPrice}, #{point_reason}, #{point_usedPoint}, #{point_futurePoint}, #{payment_date});
  	</select>
 
  	<!-- 김도연 맵퍼 -->
  	<select id="getProdDetail" resultType="com.cambak21.domain.ProductsVO">
  		select product_id, product_name, product_sellPrice, product_detail, product_img1, product_img2, product_img3, product_img4, product_shipPrice, product_title 
  		from Products where product_id = #{product_id}
  	</select>
  	
  	<select id="checkBucket" resultType="com.cambak21.domain.BucketVO">
  		select * from Buckets where member_id = #{member_id} and product_id = #{product_id}
  	</select>
  	
  	<insert id="insertBucket">
  		insert into Buckets(member_id, product_id, bucket_buyQty, bucket_sellPrice, bucket_totBuyPrice)
		value(#{member_id}, #{product_id}, #{bucket_buyQty}, #{bucket_sellPrice}, #{bucket_sellPrice})
  	</insert>
  	
  	<update id="updateBucketQty">
  		update Buckets 
  		set bucket_buyQty = #{bucket_buyQty}, bucket_totBuyPrice = #{bucket_totBuyPrice}
  		where member_id = #{member_id} and bucket_no = #{bucket_no}
  	</update>
  	
  	<select id="checkBucketQty" resultType="int">
  		select count(*) from Buckets where member_id = #{member_id}
  	</select>
  	
  	
  	<!-- 김정민 맵퍼 -->
  	
  	
  	<!-- 김태훈 맵퍼 -->
	  	<select id="prodBoardReadAll" resultType="com.cambak21.domain.ProductsVO">
	  	select * from Products where product_show="Y" order by product_id desc limit #{pageStart}, #{perPageNum};
	  </select>
	  
	  
	  <select id="prodBoardReadAllCnt" resultType="int">
	  	select count(*) from Products where product_show="Y"
	  </select>
	  
	  <select id="prodBoardRead" resultType="com.cambak21.domain.ProductsVO">
  	select * from Products where
  	<if test="searchType == 'product_name'">
  			product_name like concat('%',#{searchWord},'%')
  	</if>
  	<if test="searchType == 'product_title'">
  			product_title like concat('%',#{searchWord},'%')
  	</if>
  	<if test="searchType == 'product_detail'">
  			product_detail like concat('%',#{searchWord},'%')
  	</if>
  	and product_show="Y" order by product_id desc limit #{pageStart}, #{perPageNum};
  </select>
  
  	<select id="prodBoardReadCnt" resultType="int">
  	select count(*)  from Products where
  <if test="searchType == 'product_name'">
  			product_name like concat('%',#{searchWord},'%')
  	</if>
  	<if test="searchType == 'product_title'">
  			product_title like concat('%',#{searchWord},'%')
  	</if>
  	<if test="searchType == 'product_detail'">
  			product_detail like concat('%',#{searchWord},'%')
  	</if>
  	and product_show="Y" limit #{pageStert} ,#{pageNum}
  </select>
  
<select id="prodBoardSearch" resultType="com.cambak21.domain.ProductsVO">
	  	select * from Products where
  	<if test="searchType == 'product_name'">
  			product_name like concat('%',#{searchWord},'%')
  	</if>
  	<if test="searchType == 'product_title'">
  			product_title like concat('%',#{searchWord},'%')
  	</if>
  	<if test="searchType == 'product_detail'">
  			product_detail like concat('%',#{searchWord},'%')
  	</if>
  	and product_show="Y" order by
  	<!-- 기본 가격순 -->
  	<if test="optionType == 'defualt'">
  		product_id desc
  	</if>
  	<!-- 높은 가격순 -->
  	<if test="optionType == 'product_sellPrice_desc'">
  		product_sellPrice desc
  	</if>
  	<!-- 낮은 가격순 -->
  	<if test="optionType == 'product_sellPrice'">
  		product_sellPrice
  	</if>
  	limit #{pageStert} ,#{pageNum}	
</select>

  	<select id="prodBoardSearchId" resultType="int">
  	select count(*)  from Products where
  <if test="searchType == 'product_name'">
  			product_name like concat('%',#{searchWord},'%')
  	</if>
  	<if test="searchType == 'product_title'">
  			product_title like concat('%',#{searchWord},'%')
  	</if>
  	<if test="searchType == 'product_detail'">
  			product_detail like concat('%',#{searchWord},'%')
  	</if>
  	and product_show="Y"
  </select>
  	<!-- 백승권 맵퍼 -->
  	
  	
  	<!-- 서효원 맵퍼 -->
  	
  	
  	<!-- 박종진 맵퍼 -->
  	
  	<select id="destinationsListAjax" resultType="com.cambak21.domain.DestinationVO">
  		select * from goot6.Destinations where member_id = #{member_id} and destination_isDelete = "N"
  	</select>
  	
  	<update id="defaultModyAjax" >
  		update Destinations set default_address = #{destination_no} where member_id = #{member_id} 
  	</update>
  	
  	<update id="destiModyAjax">
  		update Destinations set destination_nickname = #{destination_nickname}, destination_address = #{destination_address}, destination_addressDetail = #{destination_addressDetail}, destination_updateDate = now(), destination_toUser = #{destination_toUser}, destination_mobile = #{destination_mobile} where destination_no = #{destination_no}    
  	</update>
  	
  	<insert id="insertDestiny">
  		insert into Destinations(member_id, destination_nickname, destination_address, destination_addressDetail, destination_toUser, destination_mobile) values(#{member_id}, #{destination_nickname}, #{destination_address}, #{destination_addressDetail}, #{destination_toUser}, #{destination_mobile})
  	</insert>	
  	
  	<update id="deleteDestiny">
  		update Destinations set destination_isDelete = "Y" where destination_no = #{destination_no}
  	</update>
  	
  	<!-- 이영광 맵퍼 -->
  	
  	
  </mapper>